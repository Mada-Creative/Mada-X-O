<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>X-O Mada Game</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; font-family: 'Cairo', sans-serif; }
    body { margin: 0; background: #f2f2f2; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; height: 100vh; overflow: hidden; position: relative; }
    .screen, .game, .result, .timer { display: none; text-align: center; }
    .screen.active, .game.active, .result.active, .timer.active { display: block; animation: fadeIn 0.6s ease forwards; }
    .avatar { width: 120px; animation: wave 1.5s ease-in-out infinite; margin: 20px auto; }
    .floating-avatar-top {
      width: 100px;
      margin: 10px auto;
      animation: floatIn 1s ease forwards;
      z-index: 10;
      display: none;
    }
    .game .floating-avatar-top {
      display: block;
    }

    @keyframes wave {
      0% { transform: rotate(0); }
      50% { transform: rotate(10deg); }
      100% { transform: rotate(0); }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes floatIn {
      from { opacity: 0; transform: translateY(-50px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .btn {
      background: #17b978;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 18px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 20px;
      transition: background 0.3s, transform 0.2s ease;
      text-decoration: none;
      display: inline-block;
    }
    .btn:hover {
      background: #138f6b;
      transform: scale(1.05);
    }
    .grid { display: grid; grid-template-columns: repeat(3, 100px); grid-gap: 5px; margin: 20px auto; }
    .cell { background: white; width: 100px; height: 100px; font-size: 40px; display: flex; align-items: center; justify-content: center; border: 2px solid #17b978; cursor: pointer; transition: transform 0.2s ease; }
    .cell:hover { transform: scale(1.05); }
    .message { font-size: 20px; margin: 20px 0; }
    .code { font-size: 24px; font-weight: bold; color: #d62828; }
    .countdown { font-size: 18px; color: #555; margin-top: 10px; }
    .disabled { pointer-events: none; opacity: 0.6; }
    a.btn { text-decoration: none !important; }
    .price-note { font-size: 16px; color: #000; margin-top: 8px; font-weight: bold; }
    .price-note del { color: #888; font-size: 14px; margin-right: 5px; }
  </style>
</head>
<body>

  <div class="floating-avatar-top">
    <img src="avatar.png" alt="Mada Avatar" style="width:100px;">
  </div>

  <div class="screen active" id="intro">
    <img src="avatar.png" alt="Mada" class="avatar">
    <p>Ø¬Ø§Ù‡Ø² ØªØªØ­Ø¯Ø§Ù†ÙŠ ÙˆÙ†Ø´ÙˆÙ Ù…ÙŠÙ† Ø¨ÙÙˆØ²ØŸ</p>
    <button class="btn" onclick="startPreGame()">ÙŠÙ„Ø§ Ù†Ù„Ø¹Ø¨!</button>
  </div>

  <div class="screen" id="preGame">
    <p>Ù†ÙŠÙ… Ø§Ù„ØªÙ„ÙÙˆÙ† Ø¹Ù„Ù‰ Ø¸Ù‡Ø±Ù‡ Ø¹Ø´Ø§Ù† Ù†Ù‚Ø¹Ø¯ Ù‚Ø¨Ø§Ù„ Ø¨Ø¹Ø¶</p>
    <button class="btn" onclick="chooseSymbol()">Ø¬Ø§Ù‡Ø²ØŒ ÙŠÙ„Ø§ Ù†Ø¨Ù„Ø´</button>
  </div>

  <div class="screen" id="choose">
    <p>Ø§Ø®ØªØ§Ø± Ø§Ù„Ø±Ù…Ø² ØªØ¨Ø¹Ùƒ</p>
    <button class="btn" onclick="startGame('X')">Ø£Ù†Ø§ X</button>
    <button class="btn" onclick="startGame('O')">Ø£Ù†Ø§ O</button>
  </div>

  <div class="game" id="gameBoard">
    <p class="message" id="gameMessage">Ø¯ÙˆØ±Ùƒ!</p>
    <div class="grid" id="grid"></div>
  </div>

  <div class="result" id="win">
    <p class="message">Ù…Ø¨Ø±ÙˆÙƒ! Ø±Ø¨Ø­Øª Ø§Ù„ØªØ­Ø¯ÙŠ ğŸ‰</p>
    <p class="code">ÙƒÙˆØ¯ Ø®ØµÙ… 70Ùª: WIN70</p>
    <p class="price-note"><del>396 Ø´ÙŠÙƒÙ„</del> Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…: <span style="color:#17b978">119 Ø´ÙŠÙƒÙ„ ÙÙ‚Ø·</span></p>
    <a class="btn" id="whatsappWin" target="_blank" onclick="confirmCoupon(this, 'win')">Ø§Ø³ØªØ¹Ù…Ù„ Ø§Ù„Ø®ØµÙ… Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</a>
    <div class="countdown" id="timer70"></div>
  </div>

  <div class="result" id="lose">
    <p class="message">Ù…Ø§ Ø²Ø¨Ø·Øª Ù…Ø¹Ùƒ ğŸ˜¢</p>
    <p class="code">ÙƒÙˆØ¯ Ø®ØµÙ… 40Ùª: TRY40</p>
    <p class="price-note"><del>396 Ø´ÙŠÙƒÙ„</del> Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…: <span style="color:#fca311">238 Ø´ÙŠÙƒÙ„ ÙÙ‚Ø·</span></p>
    <button class="btn" onclick="retryGame()">Ø§Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© (Ù…Ø±Ø© ÙˆØ­Ø¯Ø©)</button>
    <a class="btn" id="whatsappLose" target="_blank" onclick="confirmCoupon(this, 'lose')">Ø§Ø³ØªØ®Ø¯Ù… ÙƒÙˆØ¯ TRY40</a>
    <div class="countdown" id="timer40"></div>
  </div>

  <script>
    let player = 'X', bot = 'O', board = Array(9).fill(''), gameActive = true, triedBefore = false;

    const startPreGame = () => switchScreen('intro', 'preGame');
    const chooseSymbol = () => switchScreen('preGame', 'choose');

    function startGame(symbol) {
      player = symbol;
      bot = (symbol === 'X') ? 'O' : 'X';
      switchScreen('choose', 'gameBoard');
      renderBoard();
      if (player !== 'X') botMove();
      document.querySelector('.floating-avatar-top').style.display = 'block';
    }

    function switchScreen(from, to) {
      document.getElementById(from).classList.remove('active');
      document.getElementById(to).classList.add('active');
    }

    function renderBoard() {
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      board = Array(9).fill('');
      for (let i = 0; i < 9; i++) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        cell.dataset.index = i;
        cell.onclick = handlePlayerMove;
        grid.appendChild(cell);
      }
    }

    function handlePlayerMove(e) {
      const idx = e.target.dataset.index;
      if (!gameActive || board[idx]) return;
      board[idx] = player;
      e.target.textContent = player;
      if (checkWin(player)) return endGame(true);
      botMove();
    }

    function botMove() {
      let empty = board.map((val, i) => val === '' ? i : null).filter(v => v !== null);
      if (empty.length === 0) return endGame(false);
      let winChance = triedBefore ? 0.1 : 0.5;
      let idx = Math.random() < winChance ? empty[Math.floor(Math.random() * empty.length)] : empty[0];
      board[idx] = bot;
      document.querySelector(`.cell[data-index='${idx}']`).textContent = bot;
      if (checkWin(bot)) return endGame(false);
    }

    function checkWin(p) {
      const winPatterns = [
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
      ];
      return winPatterns.some(pat => pat.every(i => board[i] === p));
    }

    function endGame(playerWon) {
      gameActive = false;
      document.querySelector('.floating-avatar-top').style.display = 'none';
      if (playerWon) {
        switchScreen('gameBoard', 'win');
        startTimer('timer70', 600, 'win');
        document.getElementById('whatsappWin').href = 'https://wa.me/972525272910?text=Ø£Ù†Ø§%20ÙØ²Øª%20Ø¨Ø§Ù„ØªØ­Ø¯ÙŠ%20ÙÙŠ%20Ù„Ø¹Ø¨Ø©%20X-O%20ÙˆØ­ØµÙ„Øª%20Ø¹Ù„Ù‰%20ÙƒÙˆØ¯%2070Ùª%20WIN70ØŒ%20Ø­Ø§Ø¨Ø¨%20Ø£Ø³ØªØ¹Ù…Ù„Ù‡%20Ù„Ø´Ø±Ø§Ø¡%20Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©%20Ø§Ù„Ø±Ù‚Ù…ÙŠØ©%20Ø§Ù„Ø¢Ù†';
      } else {
        switchScreen('gameBoard', 'lose');
        startTimer('timer40', 600, 'lose');
        document.getElementById('whatsappLose').href = 'https://wa.me/972525272910?text=Ø£Ù†Ø§%20Ø¬Ø±Ø¨Øª%20Ù„Ø¹Ø¨Ø©%20X-O%20ÙˆØ­ØµÙ„Øª%20Ø¹Ù„Ù‰%20ÙƒÙˆØ¯%2040Ùª%20TRY40ØŒ%20Ø­Ø§Ø¨Ø¨%20Ø£Ø³ØªØ¹Ù…Ù„Ù‡%20Ù„Ø´Ø±Ø§Ø¡%20Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©%20Ø§Ù„Ø±Ù‚Ù…ÙŠØ©';
      }
    }

    function retryGame() {
      if (triedBefore) return;
      triedBefore = true;
      switchScreen('lose', 'gameBoard');
      renderBoard();
      gameActive = true;
      if (player !== 'X') botMove();
      document.querySelector('.floating-avatar-top').style.display = 'block';
    }

    function startTimer(elId, seconds, resultId) {
      const el = document.getElementById(elId);
      const interval = setInterval(() => {
        seconds--;
        const min = Math.floor(seconds / 60);
        const sec = seconds % 60;
        el.textContent = `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${min}:${sec < 10 ? '0' : ''}${sec}`;
        if (seconds <= 0) {
          clearInterval(interval);
          el.textContent = 'Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª â±ï¸';
          document.querySelector(`#${resultId} .btn`).style.display = 'none';
        }
      }, 1000);
    }

    function confirmCoupon(el, type) {
      el.textContent = 'ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ø§Ù„Ø®ØµÙ…!';
      el.style.background = '#fca311';
      setTimeout(() => {
        window.open(el.href, '_blank');
      }, 500);
    }
  </script>
</body>
</html>
